<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Movecount Coefficient Calculator</title>
    <style>
        .button {
            border: none;
            color: white;
            padding: 16px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            transition-duration: 0.4s;
            cursor: pointer;
        }

        .button1 {
            background-color: white;
            color: black;
            border: 2px solid #000000;
        }

        .button1:hover {
            background-color: #000000;
            color: white;
        }
    </style>
</head>

<body>
    <div style="font-family:courier new;font-size:17px">
        <button style="font-family:courier new;font-size:17px" class="button button1"
            onclick="calc()"><strong>Calculate</strong></button>
        <button style="font-family:courier new;font-size:17px" class="button button1"
            onclick="calcSort()"><strong>Calculate & Sort</strong></button><br>
        <strong>
            <input id="ignoreError" type="checkbox">Ignore Unknown Moves<br>
            <input id="ignoreAUF" type="checkbox">Disregard Starting & Ending U Moves<br><br>
        </strong>
        <table>
            <tr>
                <th>Movecount Coefficient</th>
                <th>Input: One alg per line</th>
            </tr>
            <tr>
                <th><textarea id="output" rows="28" cols="27" readonly style="text-align: right"></textarea> </th>
                <th><textarea id="input" rows="28" cols="66"></textarea></th>
            </tr>
        </table>
    </div>

    <script>
        "use strict"
        function algSpeed(sequence, ignoreErrors=false, ignoreauf=false) {
            function test(splitSeq, lGrip, rGrip, speed) {
                let lThumb = [-1, "home"]; // -1 to represent the time during AUF that you can set your fingers up
                let lIndex = [-1, "home"];
                let lMiddle = [-1, "home"];
                let lRing = [-1, "home"];
                let rThumb = [-1, "home"];
                let rIndex = [-1, "home"];
                let rMiddle = [-1, "home"];
                let rRing = [-1, "home"];
                let lOhCool = -1;
                let rOhCool = -1;
                let lWrist = lGrip;
                let rWrist = rGrip;
                let grip = 1;
                let udgrip = -1;
                let prevSpeed = null;
                let firstMoveSpeed = null;

                function overwork(finger, locationPrefer, penalty = 2.25) {
                    if (finger[1] != locationPrefer) {
                        if (speed - finger[0] < penalty) {
                            return penalty - speed + finger[0]
                        }
                    }
                    return 0
                }
                for (let j = 0; j < splitSeq.length; j++) {
                    let move = splitSeq[j];
                    let normalMove = move.toUpperCase()
                    if (prevSpeed !== null) {
                        firstMoveSpeed = speed
                        speed = prevSpeed
                    }
                    if (j < splitSeq.length - 1) {
                        if ((move[0] == "U" && splitSeq[j + 1][0] == "D") || (move[0] == "D" && splitSeq[j + 1][0] == "U")) {
                            prevSpeed = speed;
                        }
                    }
                    switch (normalMove) {
                        case "R'":
                            if (rWrist == 2) { rWrist = 0 } else if (rWrist > -1) { rWrist-- } else { return [j, speed, lWrist, -2, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])] }
                            speed++;
                            break;
                        case "R":
                            if (rWrist < 2) { rWrist++ } else { return [j, speed, lWrist, 3, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])] }
                            speed++;
                            break;
                        case "R2":
                            if (rWrist >= 1) { rWrist = -1 } else { rWrist += 2 }
                            speed += 1.65;
                            break;
                        case "U":
                            if (rWrist == 0 && (rThumb[0] + 2.25 <= speed || rThumb[1] != "top") && rIndex[1] != "m") {
                                if (overwork(rIndex, "home") <= overwork(rMiddle, "home")) {
                                    speed += overwork(rIndex, "home");
                                    speed++;
                                    rIndex = [speed, "uflick"];
                                } else {
                                    speed += overwork(rMiddle, "home");
                                    speed++;
                                    rIndex = [speed, "uflick"];
                                    rMiddle = [speed, "uflick"];                        
                                }
                            } else if (rWrist == 1 && lWrist == 0) {
                                speed += overwork(lIndex, "uflick");
                                speed++;
                                lIndex = [speed, "home"];
                            } else if (lWrist == 0) {
                                if (lIndex[1] == "uflick") {
                                    speed += overwork(lIndex, "eido", 1.75);
                                    speed = Math.max(speed, lOhCool + 2.5);
                                } else {
                                    speed += overwork(lIndex, "eido", 2.75);
                                }
                                speed++;
                                lIndex = [speed, "uflick"];
                                lOhCool = speed;
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "U'":
                            if (lWrist == 0 && (lThumb[0] + 2.25 <= speed || lThumb[1] != "top") && lIndex[1] != "m") {
                                if (overwork(lIndex, "home") <= overwork(lMiddle, "home")) {
                                    speed += overwork(lIndex, "home");
                                    speed++;
                                    lIndex = [speed, "uflick"];
                                } else {
                                    speed += overwork(lMiddle, "home");
                                    speed++;
                                    lIndex = [speed, "uflick"];
                                    lMiddle = [speed, "uflick"];                        
                                }
                            } else if (lWrist == 1 && rWrist == 0) {
                                speed += overwork(rIndex, "uflick");
                                speed++;
                                rIndex = [speed, "home"];
                            } else if (rWrist == 0) {
                                if (rIndex[1] == "uflick") {
                                    speed += overwork(rIndex, "eido", 1.75);
                                    speed = Math.max(speed, rOhCool + 2.5);
                                } else {
                                    speed += overwork(rIndex, "eido", 2.75);
                                }
                                speed++;
                                rIndex = [speed, "uflick"];
                                rOhCool = speed;
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "U2":
                            if (rWrist == 0 && (lIndex[1] == "m" || lWrist != 0 || (Math.max(overwork(rIndex, "home"), overwork(rMiddle, "home"), overwork(rRing, "u2grip")) <= Math.max(overwork(lIndex, "home"), overwork(lMiddle, "home"), overwork(lRing, "u2grip"))))) {
                                speed += overwork(rIndex, "home");
                                speed += overwork(rMiddle, "home");
                                speed += overwork(rRing, "u2grip", 1.85);
                                speed += 1.65;
                                rIndex = [speed, "uflick"];
                                rMiddle = [speed, "uflick"];
                            } else if (lWrist == 0) {
                                speed += overwork(lIndex, "home");
                                speed += overwork(lMiddle, "home");
                                speed += overwork(lRing, "u2grip", 1.85);
                                speed += 1.65;
                                lIndex = [speed, "uflick"];
                                lMiddle = [speed, "uflick"];
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "D":
                            if (lWrist == 0 && (rWrist != 0 || (Math.max(overwork(lRing, "home"), overwork(lMiddle, "home")) <= Math.max(overwork(rRing, "dflick"), overwork(rMiddle, "home"))))) {
                                speed += overwork(lRing, "home");
                                speed += overwork(lMiddle, "home");
                                speed++;
                                lRing = [speed, "dflick"];
                            } else if (rWrist == 0) {
                                speed += overwork(rRing, "dflick");
                                speed += overwork(rMiddle, "home");
                                speed++;
                                rRing = [speed, "home"];
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "D'":
                            if (rWrist == 0 && (lWrist != 0 || (Math.max(overwork(rRing, "home"), overwork(rMiddle, "home")) <= Math.max(overwork(lRing, "dflick"), overwork(lMiddle, "home"))))) {
                                speed += overwork(rRing, "home");
                                speed += overwork(rMiddle, "home");
                                speed++;
                                rRing = [speed, "dflick"]
                            } else if (lWrist == 0) {
                                speed += overwork(lRing, "dflick");
                                speed += overwork(lMiddle, "home");
                                speed++;
                                lRing = [speed, "home"];
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "D2":
                            if (rWrist == 0 && (lWrist != 0 || (Math.max(overwork(rMiddle, "home"), overwork(rRing, "home")) <= Math.max(overwork(lMiddle, "home"), overwork(lRing, "home"))))) {
                                speed += overwork(rMiddle, "home");
                                speed += overwork(rRing, "home");
                                speed += 1.65;
                                rRing = [speed, "dflick"]
                            } else if (lWrist == 0) {
                                speed += overwork(lMiddle, "home");
                                speed += overwork(lRing, "home");
                                speed += 1.65;
                                lRing = [speed, "dflick"]
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "F":
                            if (rWrist == -1) {
                                speed += overwork(rIndex, "home");
                                speed += 1;
                                rIndex = [speed, "uflick"]
                            } else if (lWrist == 1) {
                                speed += overwork(lRing, "home");
                                speed += 1;
                                lRing = [speed, "dflick"];
                            } else if (rWrist == 1) {
                                speed += overwork(rRing, "dflick");
                                speed += 1;
                                rRing = [speed, "home"]
                            } else if (lWrist == -1) {
                                speed += overwork(lIndex, "uflick");
                                speed += 1;
                                lIndex = [speed, "home"]
                            } else if (lWrist == 0 && grip == -1) {
                                speed += overwork(lThumb, "bottom");
                                speed += 1.25;
                                lThumb = [speed, "top"]
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "F'":
                            if (lWrist == -1) {
                                speed += overwork(lIndex, "home");
                                speed += 1;
                                lIndex = [speed, "uflick"]
                            } else if (rWrist == 1) {
                                speed += overwork(rRing, "home");
                                speed += 1;
                                rRing = [speed, "dflick"];
                            } else if (lWrist == 1) {
                                speed += overwork(lRing, "dflick");
                                speed += 1;
                                lRing = [speed, "home"]
                            } else if (rWrist == -1 && lWrist == 0 && overwork(lIndex, "uflick") == 0) {
                                speed += 1;
                                lIndex = [speed, "fflick"];
                            } else if (rWrist == -1 && overwork(rIndex, "uflick") == 0) {
                                speed += 1;
                                rIndex = [speed, "home"]
                            } else if (rWrist == -1) {
                                speed += overwork(rThumb, "top", 2)
                                speed += 1;
                                rWrist++;
                                rThumb = [speed, "rightu"];
                            } else if (rWrist == 0 && grip == 1) {
                                speed += overwork(rThumb, "bottom")
                                speed += 1.25;
                                rThumb = [speed, "top"]
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "F2":
                            if (rWrist == -1 && (lWrist != -1 || (Math.max(overwork(rIndex, "home"), overwork(rMiddle, "home"), overwork(rRing, "u2grip")) <= Math.max(overwork(lIndex, "home"), overwork(lMiddle, "home"), overwork(lRing, "u2grip"))))) {
                                speed += overwork(rIndex, "home");
                                speed += overwork(rMiddle, "home");
                                speed += overwork(rRing, "u2grip");
                                speed += 1.65;
                                rIndex = [speed, "uflick"];
                                rMiddle = [speed, "uflick"]
                            } else if (lWrist == -1) {
                                speed += overwork(lIndex, "home");
                                speed += overwork(lMiddle, "home");
                                speed += overwork(lRing, "u2grip");
                                speed += 1.65;
                                lIndex = [speed, "uflick"];
                                lMiddle = [speed, "uflick"];
                            } else if (rWrist == 1 && (lWrist != 1 || (Math.max(overwork(rMiddle, "home"), overwork(rRing, "home")) <= Math.max(overwork(lMiddle, "home"), overwork(lRing, "home"))))) {
                                speed += overwork(rMiddle, "home");
                                speed += overwork(rRing, "home");
                                speed += 1.65;
                                rRing = [speed, "dflick"]
                            } else if (lWrist == 1) {
                                speed += overwork(lMiddle, "home");
                                speed += overwork(lRing, "home");
                                speed += 1.65;
                                lRing = [speed, "dflick"]
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "L":
                            if (lWrist == 2) { lWrist = 0 } else if (lWrist > -1) { lWrist-- } else { return [j, speed, -2, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])] }
                            speed++;
                            break;
                        case "L'":
                            if (lWrist < 2) { lWrist++ } else { return [j, speed, 3, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])] }
                            speed++;
                            break;
                        case "L2":
                            if (lWrist > 0) { lWrist -= 2 } else { lWrist += 2 }
                            speed += 1.65;
                            break;
                        case "B":
                            if (rWrist == 1) {
                                speed += overwork(rIndex, "home");
                                speed++;
                                rIndex = [speed, "uflick"];
                            } else if (lWrist == -1) {
                                speed += overwork(lRing, "home");
                                speed += overwork(lMiddle, "home");
                                speed++;
                                lRing = [speed, "dflick"];
                            } else if (lWrist == 1) {
                                speed += overwork(lIndex, "uflick");
                                speed++;
                                lIndex = [speed, "home"];
                            } else if (rWrist == -1) {
                                speed += overwork(rRing, "dflick");
                                speed += overwork(rMiddle, "home");
                                speed++;
                                rIndex = [speed, "home"]
                            } else if (lWrist == 0 && (rWrist == 1 || rWrist == -1)) {
                                speed += overwork(lIndex, "top", 2);
                                speed++;
                                lIndex = [speed, "leftdb"];
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "B'":
                            if (lWrist == 1) {
                                speed += overwork(lIndex, "home");
                                speed++;
                                lIndex = [speed, "uflick"];
                            } else if (rWrist == -1) {
                                speed += overwork(rRing, "home");
                                speed += overwork(rMiddle, "home");
                                speed++;
                                rRing = [speed, "dflick"];
                            } else if (rWrist == 1) {
                                speed += overwork(rIndex, "uflick");
                                speed++;
                                rIndex = [speed, "home"];
                            } else if (lWrist = -1) {
                                speed += overwork(lRing, "dflick");
                                speed += overwork(lMiddle, "home");
                                speed++;
                                lIndex = [speed, "home"];
                            } else if (rWrist == 0 && (lWrist == 1 || lWrist == -1)) {
                                speed += overwork(rIndex, "top", 2);
                                speed++;
                                rIndex = [speed, "rightdb"];
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "B2":
                            if (rWrist == 1 && (lWrist != 1 || (Math.max(overwork(rIndex, "home"), overwork(rMiddle, "home"), overwork(rRing, "u2grip")) <= Math.max(overwork(lIndex, "home"), overwork(lMiddle, "home"), overwork(lRing, "u2grip"))))) {
                                speed += overwork(rIndex, "home");
                                speed += overwork(rMiddle, "home");
                                speed += overwork(rRing, "u2grip");
                                speed += 1.65;
                                rIndex = [speed, "uflick"];
                                rMiddle = [speed, "uflick"]
                            } else if (lWrist == 1) {
                                speed += overwork(lIndex, "home");
                                speed += overwork(lMiddle, "home");
                                speed += overwork(lRing, "u2grip");
                                speed += 1.65;
                                lIndex = [speed, "uflick"];
                                lMiddle = [speed, "uflick"];
                            } else if (lWrist == -1 && (lWrist != -1 || (Math.max(overwork(rMiddle, "home"), overwork(rRing, "home")) > Math.max(overwork(lMiddle, "home"), overwork(lRing, "home"))))) {
                                speed += overwork(lMiddle, "home");
                                speed += overwork(lRing, "home");
                                speed += 1.65;
                                lRing = [speed, "dflick"]
                            } else if (rWrist == -1) {
                                speed += overwork(rMiddle, "home");
                                speed += overwork(rRing, "home");
                                speed += 1.95;
                                rRing = [speed, "dflick"]
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "S":
                            if (lWrist == 0 && rWrist == 0 && overwork(rIndex, "top", 2.75) == 0) {
                                speed += 1.25;
                                rIndex = [speed, "sflick"];
                            } else if (lWrist == 0 && rWrist == -1) {
                                speed += overwork(rIndex, "home", 2.75);
                                speed += overwork(rThumb, "top", 2.75);
                                speed += overwork(rMiddle, "home", 2.75)
                                speed += 1.25;
                                rThumb = [speed, "top"];
                                rMiddle = [speed, "eflick"];
                            } else if (lWrist == 0 && rWrist == 0) {
                                speed += overwork(lIndex, "sflick", 2.75);
                                speed += 1.25;
                                lIndex = [speed, "top"];
                            } else if (lWrist == -1 && rWrist == 0) {
                                speed += overwork(lIndex, "sflick", 2.75);
                                speed += 1.25;
                                lIndex = [speed, "top"];
                                lMiddle = [speed, "spush"];
                            } else if (lWrist == 1 && rWrist == 0) {
                                speed += overwork(lIndex, "home", 2.75);
                                speed += overwork(lMiddle, "home", 2.75);
                                speed += 1.25;
                                lIndex = [speed, "e"];
                                lMiddle = [speed, "u2grip"];
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])];
                            }
                            break;
                        case "S'":
                            if (rWrist == 0 && lWrist == 0 && overwork(lIndex, "top", 2.75) == 0) {
                                speed += 1.25;
                                lIndex = [speed, "sflick"];
                            } else if (rWrist == 0 && lWrist == -1) {
                                speed += overwork(lIndex, "home", 2.75);
                                speed += overwork(lThumb, "bottom", 2.75);
                                speed += overwork(lMiddle, "home", 2.75);
                                speed += 1.25;
                                lThumb = [speed, "top"];
                                lMiddle = [speed, "eflick"];
                            } else if (rWrist == 0 && lWrist == 0) {
                                speed += overwork(rIndex, "sflick", 2.75);
                                speed += 1.25;
                                rIndex = [speed, "top"];
                            } else if (rWrist == -1 && lWrist == 0) {
                                speed += overwork(rIndex, "sflick", 2.75);
                                speed += 1.25;
                                rIndex = [speed, "top"];
                                rMiddle = [speed, "spush"];
                            } else if (rWrist == 1 && lWrist == 0) {
                                speed += overwork(rIndex, "home", 2.75);
                                speed += overwork(rMiddle, "home", 2.75);
                                speed += 1.25;
                                rIndex = [speed, "e"];
                                rMiddle = [speed, "u2grip"];
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])];
                            }
                            break;
                        case "S2":
                            if ((rWrist == -1 || rWrist == 1) && lWrist == 0) {
                                speed += overwork(rThumb, "home");
                                speed += overwork(rIndex, "home");
                                speed += overwork(rMiddle, "home");
                                speed += overwork(rRing, "u2grip");
                                speed += 2.3;
                                rMiddle = [speed, "e"];
                                rIndex = [speed, "e"];
                            } else if ((lWrist == -1 || lWrist == 1) && rWrist == 0) {
                                speed += overwork(lThumb, "home");
                                speed += overwork(lIndex, "home");
                                speed += overwork(lMiddle, "home");
                                speed += overwork(lRing, "u2grip");
                                speed += 2.3;
                                rMiddle = [speed, "e"];
                                rIndex = [speed, "e"];
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "E":
                            if ((rWrist == 1 || rWrist == -1) && lWrist == 0) {
                                speed += overwork(lIndex, "home");
                                speed += 1.25;
                                lIndex = [speed, "e"];
                            } else if ((lWrist == 1 || lWrist == -1) && rWrist == 0) {
                                speed += overwork(rIndex, "e");
                                speed += 1.25;
                                rIndex = [speed, "home"];
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "E'":
                            if ((lWrist == 1 || lWrist == -1) && rWrist == 0) {
                                speed += overwork(rIndex, "home");
                                speed += 1.25;
                                rIndex = [speed, "e"];
                            } else if ((rWrist == 1 || rWrist == -1) && lWrist == 0) {
                                speed += overwork(lIndex, "e");
                                speed += 1.25;
                                lIndex = [speed, "home"];
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "E2":
                            if ((lWrist == 1 || lWrist == -1) && rWrist == 0) {
                                speed += overwork(rIndex, "home");
                                speed += overwork(rMiddle, "home");
                                speed += overwork(rRing, "u2grip");
                                speed += 2.05;
                                rIndex = [speed, "e"];
                                rMiddle = [speed, "e"];
                            } else if ((rWrist == 1 || rWrist == -1) && lWrist == 0) {
                                speed += overwork(lIndex, "home");
                                speed += overwork(lMiddle, "home");
                                speed += overwork(lRing, "u2grip");
                                speed += 2.05;
                                lIndex = [speed, "e"];
                                lMiddle = [speed, "e"];
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "M'":
                            if (lWrist == 0) {
                                speed += overwork(lThumb, "home");
                                speed += overwork(lIndex, "m");
                                speed += overwork(lMiddle, "m");
                                speed += overwork(lRing, "m");
                                speed++;
                                lThumb = [speed, "home"];
                                lIndex = [speed, "m"];
                                lMiddle = [speed, "mflick"];
                                lRing = [speed, "m"]
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "M":
                            if (lWrist == 0) {
                                speed += overwork(lThumb, "home");
                                speed += overwork(lIndex, "m");
                                speed += overwork(lMiddle, "mflick", 2.75);
                                speed += overwork(lRing, "m");
                                speed++;
                                lThumb = [speed, "home"];
                                lIndex = [speed, "m"];
                                lMiddle = [speed, "m"];
                                lRing = [speed, "m"]
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        case "M2":
                            if (lWrist == 0) {
                                speed += overwork(lThumb, "home");
                                speed += overwork(lIndex, "m");
                                speed += overwork(lMiddle, "m");
                                speed += overwork(lRing, "m");
                                speed += 1.65;
                                lThumb = [speed, "home"];
                                lIndex = [speed, "m"];
                                lMiddle = [speed, "mflick"];
                                lRing = [speed, "m"]
                            } else {
                                return [j, speed, lWrist, rWrist, Math.max(lThumb[0], lIndex[0], lMiddle[0], lRing[0]), Math.max(rThumb[0], rIndex[0], rMiddle[0], rRing[0])]
                            }
                            break;
                        default:
                            return "Unknown move: "+move
                    }
                    if (firstMoveSpeed !== null) {
                        speed = Math.max(firstMoveSpeed, speed) + 0.5;
                        prevSpeed = null;
                        firstMoveSpeed = null;
                    }
                    if ((move[0] == "R" || move[0] == "l") && grip == -1) {
                        grip = 1;
                        speed += 1;
                    } else if ((move[0] == "r" || move[0] == "L") && grip == 1) {
                        grip = -1;
                        speed += 1;
                    }
                    if ((move[0] == "d") && udgrip == -1) {
                        udgrip = 1;
                        speed += 2.25;
                    } else if ((move[0] == "U" || move[0] == "u") && udgrip == 1) {
                        udgrip = -1;
                        speed += 2.25;
                    }
                    if (j >= 2) {
                        if ((normalMove == "R" && move == splitSeq[j - 2] && splitSeq[j - 1].toUpperCase() == "U'") || (normalMove == "R'" && move == splitSeq[j - 2] && splitSeq[j - 1].toUpperCase() == "U")) {
                            speed -= 0.5;
                        } else if ((normalMove == "R" && move == splitSeq[j - 2] && splitSeq[j - 1].toUpperCase() == "D'" && rWrist == 1) || (normalMove == "R'" && move == splitSeq[j - 2] && splitSeq[j - 1].toUpperCase() == "D")) {
                            speed -= 0.3;
                        }
                    }
                }
                return [-1, speed, lGrip, rGrip]
            }
            let splitSeq = sequence.split(" ");
            let trueSplitSeq = [];
            for (let i=0; i<splitSeq.length; i++) {
                if (ignoreErrors) {
                    if (["r","r2","r'","u","u'","u2","f","f2","f'","d","d2","d'","l","l2","l'","b","b2","b'","m","m2","m'","s","s2","s'","e","e2","e'"].includes(splitSeq[i].toLowerCase())) {
                        trueSplitSeq.push(splitSeq[i])
                    }
                } else {
                    if (splitSeq[i] != "") {
                        trueSplitSeq.push(splitSeq[i])
                    }
                }
            }
            splitSeq = trueSplitSeq.slice()
            if (ignoreauf) {
                if (splitSeq.length>=1) {
                    if (splitSeq[0][0]=="U") {
                        splitSeq.shift()
                    } else if (splitSeq.length >= 2) {
                        if (splitSeq[0][0].toLowerCase()=="d" && splitSeq[1][0]=="U") {
                            splitSeq[1] = splitSeq[0]
                            splitSeq.shift()
                        }
                    }
                }
                if (splitSeq.length>=1) {
                    if (splitSeq[splitSeq.length-1][0]=="U") {
                        splitSeq.pop()
                    } else if (splitSeq.length >= 2) {
                        if (splitSeq[splitSeq.length-1][0].toLowerCase()=="d" && splitSeq[splitSeq.length-2][0]=="U") {
                            splitSeq[splitSeq.length-2] = splitSeq[splitSeq.length-1]
                            splitSeq.pop()
                        }
                    }
                }
            }
            let tests = [test(splitSeq, 0, 0, 0), test(splitSeq, 0, -1, 0.35), test(splitSeq, 0, 1, 0.35), test(splitSeq, -1, 0, 0.35), test(splitSeq, 1, 0, 0.35)]
            while (true) {
                for (let i=0; i<tests.length; i++) {
                    if (tests[i][0] == "U") {
                        return tests[i]
                    }
                }
                let bestTest = tests[0]
                for (let i = 1; i < tests.length; i++) {
                    let compTest = tests[i];
                    if (compTest[0] == -1 && (bestTest[0] != -1 || bestTest[1] > compTest[1])) { bestTest = compTest }
                    else if (compTest[0] > bestTest[0] && bestTest[0] != -1) { bestTest = compTest }
                    else if (compTest[0] == bestTest[0] && compTest[1] < bestTest[1] && bestTest[0] != -1) { bestTest = compTest }
                }
                if (bestTest[0] == -1) { return Math.round(bestTest[1] * 100) / 100 }
                tests = [];
                for (let leftWrist = -1; leftWrist < 2; leftWrist++) {
                    for (let rightWrist = -1; rightWrist < 2; rightWrist++) {
                        let leftMatch = (bestTest[2] == leftWrist);
                        let rightMatch = (bestTest[3] == rightWrist);
                        if (!(leftMatch) || !(rightMatch)) {
                            let penalty = 2;
                            if (leftMatch) {
                                let rHandLatency = Math.max(0, 2 - (bestTest[1] - bestTest[5])); // time between last right hand motion and now
                                let rMoveLatency;
                                if (splitSeq[bestTest[0] - 1][0] == "R" || splitSeq[bestTest[0] - 2][0] == "R" || splitSeq[bestTest[0] - 1][0] == "r" || splitSeq[bestTest[0] - 2][0] == "r") { rMoveLatency = 1 } else { rMoveLatency = 0 }
                                penalty = Math.max(rHandLatency, rMoveLatency)
                            } else if (rightMatch) {
                                let lHandLatency = Math.max(0, 2 - (bestTest[1] - bestTest[4])); // time between last right hand motion and now
                                let lMoveLatency;
                                if (splitSeq[bestTest[0] - 1][0] == "L" || splitSeq[bestTest[0] - 2][0] == "L" || splitSeq[bestTest[0] - 1][0] == "l" || splitSeq[bestTest[0] - 2][0] == "l") { lMoveLatency = 1 } else { lMoveLatency = 0 }
                                penalty = Math.max(lHandLatency, lMoveLatency)
                            }
                            tests.push(test(splitSeq.slice(bestTest[0]), leftWrist, rightWrist, bestTest[1] + penalty))
                        }
                    }
                }
                splitSeq = splitSeq.slice(bestTest[0]);
            }
        }

        function calc() {
            let output = document.getElementById("output");
            output.value = "";
            let input = document.getElementById("input");
            let splitInput = input.value.split("\n");
            for (let i=0; i<splitInput.length; i++) {
                output.value += algSpeed(splitInput[i].replaceAll("2'","2"),document.getElementById("ignoreError").checked,document.getElementById("ignoreAUF").checked) + "\n"
            }
            input.rows = Math.max(28,splitInput.length+1)
            output.rows = Math.max(28,splitInput.length+1)
        }

        function customParseFloat(x) {
            let pFloat = parseFloat(x);
            if (pFloat !== pFloat) {return Infinity} else {return pFloat}
        }

        function calcSort() {
            calc()
            let output = document.getElementById("output").value;
            let input = document.getElementById("input").value;
            let outputList = output.split("\n");
            let inputList = input.split("\n");
            let sortList = [];
            for (let i=0; i<inputList.length; i++) {
                sortList.push([inputList[i],outputList[i]])
            }
            sortList.sort((x,y)=>(customParseFloat(x[1])>customParseFloat(y[1])?1:-1))
            document.getElementById("output").value = "";
            document.getElementById("input").value = "";
            for (let i=0; i<sortList.length; i++) {
                document.getElementById("output").value += sortList[i][1] + "\n";
                document.getElementById("input").value += sortList[i][0] + "\n";
            }
        }

        function good(alg) {
            let splitAlg = alg.split("  ")[0].split(" ");
            if (splitAlg[splitAlg.length-1][0]=="D") {
                splitAlg.pop()
            }
            return (splitAlg[splitAlg.length-1][0]!="U")
        }

    </script>
</body>

</html>